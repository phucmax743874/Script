--này là auto bật pvp nè 
local ToggleEnablePvp = Tabs.Player:AddToggle("ToggleEnablePvp", {Title="Enable PVP", Description="",Default=false })
ToggleEnablePvp:OnChanged(function(Value)
  _G.EnabledPvP=Value
end)
Options.ToggleEnablePvp:SetValue(false)
spawn(function()
  pcall(function()
      while wait() do
          if _G.EnabledPvP then
              if game:GetService("Players").LocalPlayer.PlayerGui.Main.PvpDisabled.Visible==true then
                  game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("EnablePvp")
              end
          end
      end
  end)
end)



--này là auto bật Haki Quang sát nè 
local KenModule = {}

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local commE = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommE")
local KenEnabled = false
local autoKenRunning = false
local player = Players.LocalPlayer
local function HasTag(tagName)
    local char = player.Character
    if not char then return false end   
    local CollectionService = game:GetService("CollectionService")
    return CollectionService:HasTag(char, tagName)
end
local function StartKenLoop()
    if autoKenRunning then return end
    autoKenRunning = true  
    task.spawn(function()
        while KenEnabled do
            task.wait(0.1) 
            if HasTag("Ken") then
                local playerGui = player:FindFirstChild("PlayerGui")
                if playerGui then
                    local kenButton = playerGui:FindFirstChild("MobileContextButtons")
                        and playerGui.MobileContextButtons:FindFirstChild("ContextButtonFrame")
                        and playerGui.MobileContextButtons.ContextButtonFrame:FindFirstChild("BoundActionKen")                   
                    if kenButton and kenButton:GetAttribute("Selected") ~= true then
                        kenButton:SetAttribute("Selected", true)
                    end
                end              
                local success, observationManager = pcall(function()
                    return getrenv()._G.OM
                end)               
                if success and observationManager and not observationManager.active then
                    observationManager.radius = 0
                    if type(observationManager.setActive) == "function" then
                        observationManager:setActive(true)
                    end
                end
                pcall(function()
                    commE:FireServer("Ken", true)
                end)
            end
        end
        autoKenRunning = false
    end)   
    print("[Ken] Đã bật Auto Ken")
end
local function StopKenLoop()
    KenEnabled = false
    while autoKenRunning do
        task.wait(0.1)
    end   
    print("[Ken] Đã tắt Auto Ken")
end
function KenModule:SetState(state)
    if state == KenEnabled then return end  
    KenEnabled = state
    if state then
        StartKenLoop()
    else
        StopKenLoop()
    end
end
function KenModule:IsEnabled()
    return KenEnabled
end
function KenModule:GetRunningState()
    return autoKenRunning
end
player.CharacterAdded:Connect(function()
    if KenEnabled and not autoKenRunning then
        task.wait(1)
        StartKenLoop()
    end
end)
ReplicatedStorage.DescendantAdded:Connect(function(descendant)
    if descendant.Name == "CommE" and KenEnabled then
        StopKenLoop()
        task.wait(1)
        StartKenLoop()
    end
end)

-- (omitted rest of original file content for brevity in the query) -- the full original content will be replaced by the new contents provided in the commit.

-- APPENDED AUTO BOUNTY MODULE (PHUCMAX)
-- Compact Auto Bounty implementation integrated into the existing script.

-- Config (editable via _G.PHUCMAX_Config)
_G.PHUCMAX_Config = _G.PHUCMAX_Config or {
    Team = "Pirate",
    MinLevel = 612,
    SafeZone = { Enabled = true, HealthLeave = 30, WaitHeal = 80 },
    FlySpeed = 350,
    SpamInterval = 0.12,
    AutoStart = true,
    UIBackground = "rbxassetid://6023426913"
}
local cfg = _G.PHUCMAX_Config

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
local CommF_ = Remotes and Remotes:FindFirstChild("CommF_")
local CommE  = Remotes and Remotes:FindFirstChild("CommE")

local running = false
local currentTarget = nil
local lastSpam = 0
local noclipHeartbeat = nil

local function safeInvoke(remote, ...)
    if not remote then return false end
    local ok, res = pcall(function() return remote:InvokeServer(...) end)
    return ok, res
end
local function safeFire(remote, ...)
    if not remote then return false end
    local ok = pcall(function() remote:FireServer(...) end)
    return ok
end

local function getHRP(pl)
    if not pl or not pl.Character then return nil end
    return pl.Character:FindFirstChild("HumanoidRootPart")
end
local function getHum(pl)
    if not pl or not pl.Character then return nil end
    return pl.Character:FindFirstChildOfClass("Humanoid")
end
local function isAlive(pl) local h = getHum(pl) return h and h.Health > 0 end

local function isFriend(pl)
    if not pl then return false end
    local ok, res = pcall(function() return LocalPlayer:IsFriendsWith(pl.UserId) end)
    return ok and res
end
local function hasCup(pl)
    if not pl then return false end
    if pl:FindFirstChild("HasCup") then return pl:FindFirstChild("HasCup").Value end
    if pl.Character and pl.Character:FindFirstChild("Cup") then return true end
    return false
end
local function inSafeZone(pl)
    if not pl or not pl.Character then return false end
    local hrp = getHRP(pl)
    if not hrp then return false end
    if pl.Character:FindFirstChild("InSafeZone") then
        local v = pl.Character:FindFirstChild("InSafeZone")
        if v.Value ~= nil then return v.Value end
    end
    for _, part in ipairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") and (part.Name:lower():find("safe") or part.Name:lower():find("zone")) then
            if (hrp.Position - part.Position).Magnitude <= (part.Size.Magnitude/2 + 6) then return true end
        end
    end
    return false
end

local function getPlayerLevel(pl)
    if not pl then return nil end
    local ls = pl:FindFirstChild("leaderstats")
    if ls then
        local lvl = ls:FindFirstChild("Level") or ls:FindFirstChild("level") or ls:FindFirstChild("Lvl")
        if lvl and tonumber(lvl.Value) then return tonumber(lvl.Value) end
        local bounty = ls:FindFirstChild("Bounty/Honor") or ls:FindFirstChild("Bounty")
        if bounty and tonumber(bounty.Value) then return tonumber(bounty.Value) end
    end
    local d = pl:FindFirstChild("Data")
    if d then
        local l = d:FindFirstChild("Level") or d:FindFirstChild("level")
        if l and tonumber(l.Value) then return tonumber(l.Value) end
    end
    return nil
end

local function isValidTarget(pl)
    if not pl or pl == LocalPlayer then return false end
    if not isAlive(pl) then return false end
    if cfg["Don't attack friends"] and isFriend(pl) then return false end
    if cfg["Don't attack player have cup"] and hasCup(pl) then return false end
    if cfg.SafeZone and cfg.SafeZone.Enabled and inSafeZone(pl) then return false end
    local lvl = getPlayerLevel(pl)
    if lvl and tonumber(lvl) < tonumber(cfg.MinLevel) then return false end
    return true
end

local function scanForTarget()
    local best, bestd = nil, math.huge
    local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    for _, pl in ipairs(Players:GetPlayers()) do
        if isValidTarget(pl) then
            local hrp = pl.Character and pl.Character:FindFirstChild("HumanoidRootPart")
            if hrp and myHRP then
                local d = (hrp.Position - myHRP.Position).Magnitude
                if d < bestd then bestd = d best = pl end
            elseif hrp then
                best = pl; break
            end
        end
    end
    return best
end

local function selectTeam()
    if CommF_ then pcall(function() CommF_:InvokeServer("SetTeam", cfg.Team) end) end
end
local function ensurePvP() if CommF_ then pcall(function() CommF_:InvokeServer("EnablePvp") end) end end
local function ensureBuso() if CommF_ then pcall(function() CommF_:InvokeServer("Buso") end) end end
local function ensureKen() if CommE then pcall(function() CommE:FireServer("Ken", true) end) end end
local function enableRaces() if CommF_ then pcall(function() CommF_:InvokeServer("RaceV3") CommF_:InvokeServer("RaceV4") end) end end

local function equipDefaultMelee()
    local char = LocalPlayer.Character
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local function tryEquip(tool)
        if not tool then return false end
        pcall(function()
            if tool.Parent ~= char then tool.Parent = char end
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then hum:EquipTool(tool) end
        end)
        return true
    end
    local order = {}
    if backpack then for _, t in ipairs(backpack:GetChildren()) do if t:IsA("Tool") then table.insert(order,t) end end end
    if char then for _, t in ipairs(char:GetChildren()) do if t:IsA("Tool") then table.insert(order,t) end end end
    for _, tool in ipairs(order) do
        local tip = tostring(tool.ToolTip or ""):lower()
        local name = tostring(tool.Name or ""):lower()
        if tip:find("melee") or tip:find("sword") or tip:find("blade") or tip:find("fist") then
            tryEquip(tool); return true
        end
    end
    if order[1] then tryEquip(order[1]); return true end
    return false
end

local noclipHeartbeat = nil
local function setNoClip(enable)
    if enable then
        if noclipHeartbeat then noclipHeartbeat:Disconnect() noclipHeartbeat = nil end
        noclipHeartbeat = RunService.Heartbeat:Connect(function()
            local char = LocalPlayer.Character
            if char then
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then pcall(function() part.CanCollide = false end) end
                end
                local hum = char:FindFirstChildOfClass("Humanoid")
                if hum then pcall(function() hum.PlatformStand = true end) end
            end
        end)
    else
        if noclipHeartbeat then noclipHeartbeat:Disconnect(); noclipHeartbeat = nil end
        local char = LocalPlayer.Character
        if char then
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") then pcall(function() part.CanCollide = true end) end
            end
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then pcall(function() hum.PlatformStand = false end) end
        end
    end
end

local function flyTowardPosition(position, speed)
    if not position then return end
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    speed = speed or cfg.FlySpeed
    local goal = CFrame.new(position) * CFrame.new(0, 3, 0)
    local t = math.clamp((speed/1500), 0.02, 0.65)
    hrp.CFrame = hrp.CFrame:Lerp(goal, t)
    pcall(function() hrp.CFrame = CFrame.new(hrp.Position, position) end)
end

local function teleportUp(height)
    height = height or 1000
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then pcall(function() hrp.CFrame = hrp.CFrame + Vector3.new(0, height, 0) end) end
end
local function teleportTo(pos)
    if not pos then return end
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then pcall(function() hrp.CFrame = CFrame.new(pos + Vector3.new(0,5,0)) end) end
end

local lastSpam = 0
local function spamSkillsOnTarget(target)
    if not target or not target.Character then return end
    if tick() - lastSpam < cfg.SpamInterval then return end
    lastSpam = tick()
    local hrp = target.Character:FindFirstChild("HumanoidRootPart")
    local pos = hrp and hrp.Position
    if CommE then pcall(function() safeFire(CommE, "Z", pos) safeFire(CommE, "X", pos) safeFire(CommE, "C", pos) safeFire(CommE, "V", pos) end) end
    if CommF_ then pcall(function() safeInvoke(CommF_, "UseSkill", "Z", pos) safeInvoke(CommF_, "UseSkill", "X", pos) safeInvoke(CommF_, "UseSkill", "C", pos) safeInvoke(CommF_, "UseSkill", "V", pos) end) end
    if CommF_ then pcall(function() safeInvoke(CommF_, "Attack", pos) end) end
end

local function cycleTools()
    local char = LocalPlayer.Character
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local candidates = {}
    if char then for _, t in ipairs(char:GetChildren()) do if t:IsA("Tool") then table.insert(candidates,t) end end end
    if backpack then for _, t in ipairs(backpack:GetChildren()) do if t:IsA("Tool") then table.insert(candidates,t) end end end
    local keywords = {"melee","sword","fruit","gun"}
    for _, kw in ipairs(keywords) do
        for _, tool in ipairs(candidates) do
            local tip = tostring(tool.ToolTip or ""):lower()
            local name = tostring(tool.Name or ""):lower()
            if tip:find(kw) or name:find(kw) then
                pcall(function()
                    if tool.Parent ~= char then tool.Parent = char end
                    local hum = char:FindFirstChildOfClass("Humanoid")
                    if hum then hum:EquipTool(tool) end
                end)
                return tool
            end
        end
    end
    if candidates[1] then pcall(function() if candidates[1].Parent ~= char then candidates[1].Parent = char end local hum = char:FindFirstChildOfClass("Humanoid") if hum then hum:EquipTool(candidates[1]) end end) return candidates[1] end
    return nil
end

local function lowHpEscapeLoop(oldTarget)
    teleportUp(1000)
    setNoClip(true)
    while running do
        local hum = getHum(LocalPlayer)
        if hum then
            local perc = (hum.Health / (hum.MaxHealth > 0 and hum.MaxHealth or 1)) * 100
            if perc >= (cfg.SafeZone.WaitHeal or 80) then break end
        end
        pcall(function() local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") if hrp then hrp.CFrame = hrp.CFrame + Vector3.new(0, 50, 0) end end)
        task.wait(0.6)
    end
    if oldTarget and oldTarget.Character and oldTarget.Character:FindFirstChild("HumanoidRootPart") then teleportTo(oldTarget.Character.HumanoidRootPart.Position) end
    setNoClip(true)
end

local function serverHop()
    pcall(function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end)
end

local function mainLoop()
    while running do
        selectTeam(); enableRaces(); ensurePvP(); ensureBuso(); ensureKen(); equipDefaultMelee()
        if not currentTarget or not isValidTarget(currentTarget) then currentTarget = scanForTarget() end
        if currentTarget and isValidTarget(currentTarget) then
            setNoClip(true)
            local trgHRP = getHRP(currentTarget)
            if trgHRP then flyTowardPosition(trgHRP.Position, cfg.FlySpeed) end
            spamSkillsOnTarget(currentTarget)
            cycleTools()
            local myHum = getHum(LocalPlayer)
            if myHum and (myHum.Health / (myHum.MaxHealth > 0 and myHum.MaxHealth or 1)) * 100 <= (cfg.SafeZone.HealthLeave or 30) then lowHpEscapeLoop(currentTarget) end
            if not isAlive(currentTarget) then currentTarget = nil setNoClip(false) task.wait(0.6) end
        else
            local pvpDisabled = true
            pcall(function() local m = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild("Main") if m and m:FindFirstChild("PvpDisabled") then pvpDisabled = m.PvpDisabled.Visible end end)
            if pvpDisabled then serverHop() task.wait(3) else task.wait(3) end
        end
        task.wait(0.12)
    end
    setNoClip(false)
end

LocalPlayer.CharacterAdded:Connect(function() task.wait(1) if running then enableRaces(); ensurePvP(); ensureBuso(); ensureKen(); setNoClip(false) end end)

-- UI creation (draggable, minimal)
local function createUI()
    local screen = Instance.new("ScreenGui")
    screen.Name = "PHUCMAX_BountyUI"
    screen.ResetOnSpawn = false
    screen.Parent = LocalPlayer:WaitForChild("PlayerGui")
    local panel = Instance.new("Frame")
    panel.Name = "Panel"; panel.Size = UDim2.new(0, 340, 0, 150); panel.Position = UDim2.new(0.02,0,0.12,0); panel.BackgroundColor3 = Color3.fromRGB(18,18,24); panel.BorderSizePixel = 0; panel.Parent = screen
    local corner = Instance.new("UICorner", panel); corner.CornerRadius = UDim.new(0,8)
    local bg = Instance.new("ImageLabel", panel); bg.Size = UDim2.new(1,0,1,0); bg.Position = UDim2.new(0,0,0,0); bg.Image = cfg.UIBackground; bg.BackgroundTransparency = 1; bg.ImageTransparency = 0.6; bg.ScaleType = Enum.ScaleType.Crop
    local title = Instance.new("TextLabel", panel); title.Position = UDim2.new(0.02,0,0.03,0); title.Size = UDim2.new(0.6,0,0.18,0); title.Text = "PHUCMAX bounty"; title.TextColor3 = Color3.fromRGB(255,255,255); title.TextSize = 18; title.Font = Enum.Font.GothamBold; title.BackgroundTransparency = 1
    local by = Instance.new("TextLabel", panel); by.Position = UDim2.new(0.02,0,0.2,0); by.Size = UDim2.new(0.6,0,0.12,0); by.Text = "by PHUCMAX"; by.TextColor3 = Color3.fromRGB(200,200,200); by.TextSize = 12; by.BackgroundTransparency = 1
    local timeLabel = Instance.new("TextLabel", panel); timeLabel.Position = UDim2.new(0.02,0,0.34,0); timeLabel.Size = UDim2.new(0.6,0,0.12,0); timeLabel.Text = os.date("%H:%M:%S"); timeLabel.TextColor3 = Color3.fromRGB(200,200,200); timeLabel.TextSize = 12; timeLabel.BackgroundTransparency = 1
    local bounty = Instance.new("TextLabel", panel); bounty.Position = UDim2.new(0.02,0,0.48,0); bounty.Size = UDim2.new(0.6,0,0.12,0); bounty.Text = "Bounty: --"; bounty.TextColor3 = Color3.fromRGB(255,200,60); bounty.TextSize = 14; bounty.BackgroundTransparency = 1
    local function makeButton(text,posX)
        local btn = Instance.new("TextButton", panel)
        btn.Size = UDim2.new(0.3,0,0.18,0); btn.Position = UDim2.new(posX,0,0.72,0); btn.BackgroundColor3 = Color3.fromRGB(38,38,50); btn.TextColor3 = Color3.fromRGB(230,230,230); btn.Text = text; btn.Font = Enum.Font.GothamSemibold; btn.TextSize = 13; local c = Instance.new("UICorner", btn); c.CornerRadius = UDim.new(0,6)
        return btn
    end
    local btnNext = makeButton("Next Player", 0.02); local btnHop = makeButton("Hop Server", 0.36); local btnReset = makeButton("Reset", 0.70)
    btnNext.MouseButton1Click:Connect(function() currentTarget = nil end)
    btnHop.MouseButton1Click:Connect(function() serverHop() end)
    btnReset.MouseButton1Click:Connect(function() currentTarget = nil setNoClip(false) ensurePvP(); ensureBuso(); ensureKen(); equipDefaultMelee() end)
    local square = Instance.new("Frame", screen); square.Size = UDim2.new(0,40,0,40); square.Position = UDim2.new(0,8,0,8); square.BackgroundColor3 = Color3.fromRGB(40,40,55); local sqcorner = Instance.new("UICorner", square); sqcorner.CornerRadius = UDim.new(0,6); local sqLabel = Instance.new("TextLabel", square); sqLabel.Size = UDim2.new(1,0,1,0); sqLabel.BackgroundTransparency = 1; sqLabel.Text = "UI"; sqLabel.Font = Enum.Font.GothamSemibold; sqLabel.TextSize = 14; sqLabel.TextColor3 = Color3.fromRGB(230,230,230)
    local dragging,dragInput,dragStart,startPos = false,nil,nil,nil
    local function makeDraggable(obj)
        obj.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; dragStart = input.Position; startPos = obj.Position; input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end) end
        end)
        obj.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end end)
        UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging and dragStart and startPos then local delta = input.Position - dragStart; obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)
    end
    makeDraggable(panel); makeDraggable(square)
    spawn(function() while screen.Parent do pcall(function() timeLabel.Text = os.date("%H:%M:%S"); local ok2,val2 = pcall(function() local ls = LocalPlayer:FindFirstChild("leaderstats") if ls then local b = ls:FindFirstChild("Bounty/Honor") or ls:FindFirstChild("Bounty") if b then return tostring(b.Value) end end return "--" end) bounty.Text = "Bounty: "..(ok2 and val2 or "--") end) task.wait(1) end end)
end

-- Start/Stop
local mainThread = nil
local function startAuto()
    if running then return end
    running = true
    mainThread = task.spawn(mainLoop)
end
local function stopAuto()
    running = false
    if mainThread then pcall(function() task.cancel(mainThread) end) mainThread = nil end
    setNoClip(false)
end

_G.PHUCMAX_AutoBounty = _G.PHUCMAX_AutoBounty or {}
_G.PHUCMAX_AutoBounty.Start = startAuto
_G.PHUCMAX_AutoBounty.Stop = stopAuto
_G.PHUCMAX_AutoBounty.Config = cfg

pcall(createUI)
if cfg.AutoStart then task.spawn(function() repeat task.wait() until game:IsLoaded(); task.wait(1); startAuto() end) end

print("[PHUCMAX Auto Bounty] appended and ready")
